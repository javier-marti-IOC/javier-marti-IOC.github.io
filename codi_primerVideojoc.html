    <!doctype html> 
    <html lang="en"> 
    <head> 
        <meta charset="UTF-8" />
        <title> Primer videojoc en Phaser 3 </title>
        <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
        <style type="text/css">
            /* Aquí centrem la pantalla*/
            body {
                
            max-width: max-content;
            margin: auto;

            }
        </style>
    </head>
    <body>
     
    <script type="text/javascript">
     // Creem el videojoc, li donem la resolució de 800x 600, les físiques que utilitzarem i la gravetat d'aquest. També creem totes les variables que utilitzarem més endavant.
    var config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 310 },
                debug: false
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };
     
    var player;
    var peixos;
    var gotas;
    var platforms;
    var cursors;
    var score = 0;
    var gameOver = false;
    var scoreText;

     
    var game = new Phaser.Game(config);
    
    //  Precarreguem les imatges del fons, sprites, spritesheet del personatge, plataformes i àudios.
    function preload ()
    {
        this.load.image('fons_capa0', 'assets/fons_capa0.png');
        this.load.image('fons_capa1', 'assets/fons_capa1.png');
        this.load.image('fons_capa2', 'assets/fons_capa2.png');
        this.load.audio('music', ['assets/Sound/Jungle.mp3', 'assets/Sound/Jungle.ogg']);
        this.load.audio('fish', ['assets/Sound/fish.mp3', 'assets/Sound/fish.ogg']);
        this.load.audio('cat', ['assets/Sound/cat.mp3', 'assets/Sound/cat.ogg']);
        this.load.image('terreny', 'assets/plataformas.png');
        this.load.image('peix', 'assets/peix.png');
        this.load.image('gota', 'assets/gota.png');
        this.load.spritesheet('tet', 'assets/tet.png', { frameWidth: 64, frameHeight: 64 });
    }
     
    //Aquí creem tots els objectes que utilitzarem
    function create ()
    {

        // Creem les músiques i els efectes, i li donem una configuració a la música de fons i l'executem.
        this.music = this.sound.add('music');
        var musicConfig = {
            mute:false,
            volume: 0.1,
            rate: 1,
            detune: 0,
            seek: 0,
            loop: true,
            delay: 0
        }
        this.music.play(musicConfig);

        this.catchFish = this.sound.add('fish');
        this.catchcat = this.sound.add('cat');
        

        //  Un fons de 3 capes per al nostre joc, i escalem la del mig per a que ocupi tota la imatge.
        this.add.image(400, 300, 'fons_capa0');
        this.add.image(400, 300, 'fons_capa1').setScale(1.9);
        this.add.image(400, 300, 'fons_capa2');

     
        //  El grup de plataformes
        platforms = this.physics.add.staticGroup();
     
        // Aquí creem el terreny.
        // Cada plataforma està col·locada per a coincidir amb les capes del fons i els objectes d'aquesta.
        platforms.create(400,588,'terreny');
        platforms.create(-150,460,'terreny');
        platforms.create(900,427,'terreny');
        platforms.create(918,235,'terreny');
        platforms.create(-200,235,'terreny');
        platforms.create(1100,107,'terreny');
        platforms.create(-100,265,'terreny');
        
        
        // El jugador i la seva configuració, se li afegueix un modificador del sprite per a que les col·lisions siguin mes precises
        player = this.physics.add.sprite(100, 450, 'tet');
        player.body.setSize(35,35).setOffset(15,25);
        
     
        //  Propietats de la física del jugador. Afegeix un petit rebot al jugador en caure.
        player.setBounce(0.2);
        player.setCollideWorldBounds(true);
     
        //  Les animacions dels nostres jugadors, girant, caminant a l’esquerra i caminant a la dreta.
        this.anims.create({
            key: 'left',
            frames: this.anims.generateFrameNumbers('tet', { start: 0, end: 3 }),
            frameRate: 10,
            repeat: -1
        });
     
        this.anims.create({
            key: 'turn',
            frames: [ { key: 'tet', frame: 4 } ],
            frameRate: 20
        });
     
        this.anims.create({
            key: 'right',
            frames: this.anims.generateFrameNumbers('tet', { start: 5, end: 8 }),
            frameRate: 10,
            repeat: -1
        });
     
        //  Events d'entrada amb el teclat
        cursors = this.input.keyboard.createCursorKeys();
     
        //  Alguns peixos per recollir, 8 en total, separades uniformement a 100 píxels al llarg de l'eix X
        peixos = this.physics.add.group({
            key: 'peix',
            repeat: 7,
            setXY: { x: 25, y: 0, stepX: 100 }
        });
     
        peixos.children.iterate(function (child) {
     
            //  Cada peix fa un rebot lleugerament diferent
            child.setBounceY(Phaser.Math.FloatBetween(0.2, 0.5));
     
        });
     
        gotas = this.physics.add.group();
     
        //  La puntuació
        scoreText = this.add.text(16, 16, 'Peixos= 0', { fontSize: '32px', fill: '#FFFF00'});
     
        //  Xoca el jugador i els peixos amb les plataformes
        this.physics.add.collider(player, platforms);
        this.physics.add.collider(peixos, platforms);
        this.physics.add.collider(gotas, platforms);
     
        //  Comprova si el jugador col·lisiona amb algun peix, si crida ho fa, a la funció collectPeix
        this.physics.add.overlap(player, peixos, collectPeix, null, this);
        //  Comprova si el jugador col·lisiona amb alguna gota, si crida ho fa, a la funció hitGota
        this.physics.add.collider(player, gotas, hitGota, null, this);
    }
    
    //  Aquí actualitza la situació del jugador, a quina velocitat gira i la velocitat de salt.
    function update ()
    {
        if (gameOver)
        {
            return;
        }
     
        if (cursors.left.isDown)
        {
            player.setVelocityX(-160);
     
            player.anims.play('left', true);
        }
        else if (cursors.right.isDown)
        {
            player.setVelocityX(160);
     
            player.anims.play('right', true);
        }
        else
        {
            player.setVelocityX(0);
     
            player.anims.play('turn');
        }
     
        if (cursors.up.isDown && player.body.touching.down)
        {
            player.setVelocityY(-330);
        }
    }
     
    // Aquí crida la seguent funció si hi ha una col·lisió i salta la funció collectPeix 
    function collectPeix (player, peix)
    {
        this.catchFish.play();
        peix.disableBody(true, true);
     
        //  Afegeix i actualitza la puntuació
        score += 1;
        scoreText.setText('Peixos= ' + score);
     
        if (peixos.countActive(true) === 0)
        {
            //  Un nou lot de peixos per a col·leccionar
            peixos.children.iterate(function (child) {
     
                child.enableBody(true, child.x, 0, true, true);
     
            });
            // Aquí creem dues gotas diferents que apareixeran al costat oposat del jugador
            var x = (player.x < 400) ? Phaser.Math.Between(400, 800) : Phaser.Math.Between(0, 400);
     
            var gota = gotas.create(x, 16, 'gota');
            gota.setBounce(1);
            gota.setCollideWorldBounds(true);
            gota.setVelocity(Phaser.Math.Between(-200, 200), 20);
            gota.allowGravity = false;

            var x = (player.x < 400) ? Phaser.Math.Between(400, 800) : Phaser.Math.Between(0, 400);
     
            var gota = gotas.create(x, 16, 'gota').setScale(1.2);
            gota.setBounce(1);
            gota.setCollideWorldBounds(true);
            gota.setVelocity(Phaser.Math.Between(-200, 200), 20);
            gota.allowGravity = false;
     
        }
    }
    
    // Aquí crida la seguent funció si hi ha una col·lisió i salta la funció hitGota  
    function hitGota (player, gota)
    {
        this.physics.pause();
     
        player.setTint(0xff0000);
     
        player.anims.play('turn');
     
        gameOver = true;


        this.catchcat.play();
        gameOver = this.add.text(210, 300, 'GAME OVER', { fontSize: '64px', fill: '#FFFF00'});
    }
     
    </script>
     
    </body>
    </html>